# 리팩터링 원칙

## 리팩터링 정의

리팩터링(명사): 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고, 수정하기 쉽도록 내부 구조를 변경하는 기법

리팩터링(동사): 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

흔히 코드를 정리하는 작업을 리팩터링이라고 하지만 앞에서 제시한 정의에 따르면 특정한 방식에 따라 코드를 정리하는 것만이 리팩터링이다.

리팩터링은 결국 동작을 보존하는 작은 단계들을 거쳐 코드를 수정하고, 이러한 단계들을 순차적으로 연결하여 큰 변화를 만들어내는 일이다.

=> 리팩토링 중에는 항상 코드가 정상 동작을 하기 때문에 언제든지 멈출 수 있다.

리팩터링의 목적은 코드를 이해하고 수정하기 쉽게 만드는 것으로 성능이 좋아질수도 나빠질수도있다.

## 두개의 모자

기능추가인지 리팩터링인지 구분을 하여 개발을 한다.
기능 추가할 떄는 기능추가 모자를 쓰고 기존 코드는 절대 건드리지 않고 새기능을 추가하고, 리팩터링할 떄는 기능추가는 절대하지 않고, 코드 재구성만 신경 쓴다. => 자신이 무엇을 하고자 하는지 분명히 알고 코드를 짜자.

## 리팩터링 하는 이유

- 소프트웨어 설계가 좋아진다.
  - 규칙적인 리팩터링으로 코드의 구조를 유지하자.(ex: 중복코드 제거)
- 소프트웨어를 이해하기 쉬워진다.
  - 코드를 통해 의도를 더 명확하게 전달하여 다른 사람(자신 포함)과 협업을 원활하게 할 수 있다.
- 버그를 쉽게 찾을 수 있다.
- 프로그래밍 속도를 높일 수 있다.
  - 코드 개발 속도를 높일 수 있다.
  - 리팩터링하는 시간이 있어서 더 오래 걸린다고 생각 할 수 있지만 지구력적인 측면에서 보면 더 오래 지속적으로 빠르게 개발 할 수 있다.

## 언제?

작업 흐름에 리팩터링을 녹이는 방법 => 3의 법칙

### 3의 법칙

1. 처음에 그냥한다.
2. 비슷한 일을 두번째로 하면 계속한다.
3. 비슷한 일을 세번째로 하면 리팩터링한다.

- 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
- 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
- 쓰레기 줍기 리팩터링: 비효율적인 코드 발견 =>간단하면 즉시 고치고, 아니면 메모를 남기고 하던 일 마친 후에
- 계획된 리팩터링과 수시로 하는 리팩터링
  - 리팩터링을 위한 일정을 따로 정하지 않고, 항상 함께한다.
- 오래 걸리는 리팩터링
  - 팀단위로 하는 경우 모두가 오래걸리는 리팩터링에 매달리기 보다 조금씩 몇주에 걸친 해결이 좋다.
- 코드리뷰에 리팩터링 활용하기 : 작성자와 나란히 앉아서 리팩터링=> 짝 프로그래밍

리팩터링의 가치를 이해하지 못하는 사람에게는 리팩터링한다고 말하지 말고 그냥 진행해라. 어차피 이것이 가장 빠른 길이기 때문이다.

### 리팩터링 하지 말아야 할 때

- 외부에서 호출해서 사용하는 코드(내부로직을 이해해야 할 때 리팩터링)
- 새로 작성하는게 더 빠른 경우

## 리팩터링 시 고려할 문제

- 새 기능 개발 속도 저하 : 결국은 가장 빠른 길이다.
- 코드 소유권: 코드 소유권을 작은 단위로 나눠 엄격히 관리하기 보단 느슨하게 정하여 다른 사람도 수정할 수 있게 하자.
- 브랜치: 독립 브랜치에서 오래 작업할수록 마스터에 통합하기 어려워진다. => 브랜치 작업 기간을 2~3일 단위로 짧게 관리(더 짧아도 됨)  
  => 거대기능을 잘게 자를 수 있어야 하고, 기능을 토글기능을 넣어 메인 플로우를 해치지 않게 한다.

  CI(지속적 통합)와 XP가 리팩터링과 잘어울린다.

## 리팩터링, 아키텍처, 애그니

리팩터링을 통해 아키텍처를 대폭 변경할 수 있다.
=> 요구사항 변화에 자연스럽게 대응하도록 코드 베이스를 잘 설계해준다.

### 애그니(YAGNI)

You Aren't Going to Need It의 약자로 유연성 메커니즘 중 하나이다.

## 리팩터링과 소프트웨어 개발 프로세스

XP: 지속적 통합 + 자가테스트코드+ 리팩터링
=> 3개를 잘 조화시키면 요구사항 변화에 빠르게 대응하고 안정적인 선순화 구조를 가질 수 있다.
(자가테스트코드+ 리팩터링 =TDD)

## 리팩터링과 성능

리팩터링하면 성능이 느려질 수 있지만 빠르게 만드는 튜닝을 하기 더 쉬워진다.

### 빠른 소프트웨어 작성하기

- 시간 예산 분배 방식: 설계를 여러 컴포넌트에 나눠서 컴포넌트 마다 시간과 공간을 할당한다.

- 끊임없는 관심
- 90%의 시간은 낭비: 성능은 극히 일부에서 낭비하고 있다.  
  => 성능 최적화 전까지는 성능에 신경을 쓰지 않고, 코드를 다루기 쉽게 만들고, 성능 최적화 단계가 되면 성능을 잡아먹는 지점을 찾아 최적화한다.
