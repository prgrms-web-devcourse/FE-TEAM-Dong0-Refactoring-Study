# 6장

- 가장 많이 사용되는 기법으로는 _함수 추출하기_, *변수 추출하기*가 있고 이와 반대 역할을 하는 _함수 인라인하기_, *변수 인라인하기*가 있다.

## 6.1 함수 추출하기(Extract Function, 158p)

- 코드 조각이 하는 일을 파악하고 독립된 함수로 추출하고 목적에 맞는 이름을 붙인다.
  - 기준은 길이에 따라 한 화면이 넘어갈 때, 재사용성에 따라 두 번 이상 사용될 때 등 설정할 수 있고, 필자는 **목적과 구현을 분리**
- 함수를 짧게 많이 만들었을 때 잦은 호출에 대한 성능 걱정은 할 필요 없음
- 문서 없이 코드만으로 이해가 가게끔 이름을 잘 짓는 것이 중요
- 절차
  1. 함수를 새로 만들고 이름 짓기(처음부터 최선이 아니어도 됨)
  2. 추출할 부분을 복사 붙여넣기
  3. 원본 함수의 지역 변수를 참조하거나 유효범위를 벗어나는 것들 체크, 있으면 매개변수로 전달
  4. 원래 부분을 새 함수 호출로 대체
  5. 새 함수로 대체할만한 곳이 있는지 다른 곳도 체크
- 형태
  - 유효범위를 벗어나는 변수 없을 때는 바로 복사 붙여넣기
  - 지역 변수를 사용하지만 다른 값을 대입하지는 않을 때는 매개변수로만 넘기기
  - 지역 변수의 값을 변경할 때
    - 추출함수 안에서만 사용
    - 추출함수 밖에서 사용: 수정된 값 return

## 6.2 함수 인라인하기(Inline Function, 169p)

- 잘못 추출되거나 간접 호출이 많이 쓰인 코드를 인라인하기
- 절차
  1. 다형 메서드인지 확인(서브클래스가 오버라이드하는 메서드는 인라인 X)
  2. 인라인할 함수를 호출하는 곳을 찾기
  3. 각 호출문을 함수 본문으로 교체
  4. 원래 함수 삭제
- 단순히 잘라붙이는 것이 가능할 수도 있고, 복잡하다면 한 문장씩 옮겨보자

## 6.3 변수 추출하기(Extract Variable, 173p)

- 표현식이 복잡할 때 지역 변수를 활용하여 로직을 구성하는 단계마다 이름을 붙이고, 목적을 명확하게 드러냄

  - 변수를 breakpoint로 사용하여 디버깅에도 도움이 된다.

- 절차

  1. 추출하려는 표현식의 부작용 체크
  2. 불변 변수를 선언하고 표현식의 복제본 대입
  3. 원본을 새로 만든 변수로 교체
  4. 표현식이 여러 곳에서 사용된다면 각각 새로 만든 변수로 교체

```js
function price1(order) {
  return (
    order.수량 * order.상품가격 - // 기본 가격
    Math.max(0, order.수량 - 500) * order.상품가격 * 0.05 + // 수량 할인
    Math.min(order.수량 * order.상품가격 * 0.1, 100) // 배송비
  );
}
```

```js
function price2(order) {
  const 기본가격 = order.수량 * order.상품가격;
  const 수량할인 = Math.max(0, order.수량 - 500) * order.상품가격 * 0.05;
  const 배송비 = Math.min(order.수량 * order.상품가격 * 0.1, 100);

  return 기본가격 + 수량할인 - 배송비;
}
```

- 위 상황이 `Order` 클래스와 `price()` 메서드로 구성된다면 `기본가격()`, `수량할인()`, `배송비()` 메서드로 추출해보자
- 객체는 특정 로직과 데이터를 외부와 공유하려 할 때 적당한 크기의 문맥이 되어준다.

## 6.4 변수 인라인하기(Inline Variable, 178p)

- 변수는 함수 안에서 표현식을 가리키는 이름으로 쓰임
- 그 이름이 표현식과 큰 차이가 없다면 인라인하자

## 6.5 함수 선언 바꾸기(Change Function Declaration, 179p)

- 함수는 프로그램을 작은 부분으로 나누는 수단
- 좋은 함수 이름 짓기 => 주석으로 함수의 목적을 설명해보자
- 간단한 절차
  1. 매개변수를 제거하려면, 함수 본문에서 제거 대상 매개변수를 참조하는 곳이 있는지 체크
  2. 메서드 선언을 원하는 형태로 변경
  3. 기존 메서드 선언을 참조하는 부분을 바뀐 형태로 변경
- 세분화된 절차
  1. 함수 본문 리팩터링
  2. 임시 이름을 붙여서 함수 본문을 새 함수로 추출
  3. 간단한 절차 진행
  4. 기존 함수 인라인하기(기존 함수 호출문을 새 함수 호출문으로 교체)
  5. 임시로 붙인 이름을 원래 이름으로 돌리기

## 6.6 변수 캡슐화하기(Encapsulate Variable, 188p)

- 함수는 데이터보다 다루기 수월하다.
  - 데이터는 참조하는 모든 부분을 한 번에 바꿔야 함
- 접근할 수 있는 범위가 넓은 데이터를 옮길 때는 그 데이터로의 접근을 독점하는 함수로 캡슐화 == 데이터 재구성을 함수 재구성으로 하게끔
- 절차
  1. 변수로의 접근과 갱신을 전담하는 캡슐화 함수 만들기
  2. 정적 검사
  3. 변수를 직접 참조하던 부분을 모두 캡슐화 함수 호출로 변경
  4. 변수 접근 범위 제한
     - `변수.js`에 변수 선언하고 getter와 setter만 export
  5. 변수 값이 레코드라면 레코드 캡슐화하기(7.1) 고려
- getter와 setter의 반환 값을 고려할 때 원본 데이터에 영향을 줘야 할지, 복제(`Object.assign()`, 클래스 인스턴스)를 해서 반환할지 정하자
