# 6. 기본적인 리팩토링

## 6-1. 함수 추출하기
함수를 분리하는 기준 : `목적과 구현을 분리`

코드를 보고 무슨 일을 하는지 파악하는 데 한참 걸린다면 그 부분을 함수로 추출한 후 `무슨 일`에 걸맞는 이름을 짓는다.

🤔 함수를 짧게 만들면 함수 호출이 많아져서 성능이 느려지지는 않을까?
함수가 짧으면 캐싱하기가 더 쉽기 때문에 컴파일러 최적화에 유리하다

### 예시 : 유효범위를 벗어나는 변수가 없을 때

``` js
function printOwing(invoice) {
    let outstanding = 0;

    console.log('***********');
    console.log('**고객 채무**');
    console.log('***********');

    // 미해결 채무를 계산한다.
    for (const o of invoice.orders) {
      outstanding += o.amount;
    }

    // 마감일을 기록한다.
    const today = Clock.today; // https://martinfowler.com/bliki/ClockWrapper.html
    invoice.dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 30);

    console.log(`고객명: ${invoice.customer}`);
    console.log(`채무액: ${outstanding}`);
    console.log(`마감일: ${invoice.dueDate.toLocaleDateString()}`);
}
```

1. 배너 출력 로직을 함수로 추출
   
```js
    function printOwing(invoice) {
    let outstanding = 0;

    printBanner();

    // 미해결 채무를 계산한다.
    for (const o of invoice.orders) {
      outstanding += o.amount;
    }

    // 마감일을 기록한다.
    const today = Clock.today; // https://martinfowler.com/bliki/ClockWrapper.html
    invoice.dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 30);

    console.log(`고객명: ${invoice.customer}`);
    console.log(`채무액: ${outstanding}`);
    console.log(`마감일: ${invoice.dueDate.toLocaleDateString()}`);

    function printBanner(){
        console.log('***********');
        console.log('**고객 채무**');
        console.log('***********');
    }
}
```

2. 세부사항을 출려하는 코드도 추가한다.
   
```js
    function printOwing(invoice) {
        let outstanding = 0;

        printBanner();

        // 미해결 채무를 계산한다.
        for (const o of invoice.orders) {
        outstanding += o.amount;
        }

        // 마감일을 기록한다.
        const today = Clock.today; // https://martinfowler.com/bliki/ClockWrapper.html
        invoice.dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 30);

        printDetails();

        function printBanner(){
            console.log('***********');
            console.log('**고객 채무**');
            console.log('***********');
        }

        function printDetails(){
            console.log(`고객명: ${invoice.customer}`);
            console.log(`채무액: ${outstanding}`);
            console.log(`마감일: ${invoice.dueDate.toLocaleDateString()}`);
        }
    }
```

### 지역변수의 값을 변경할 때

1. 선언문을 변수가 사용되는 코드 근처로 슬라이드한다.

```js
    function printOwing(invoice) {
        printBanner();

        let outstanding = 0;
        // 미해결 채무를 계산한다.
        for (const o of invoice.orders) {
        outstanding += o.amount;
        }

        // 마감일을 기록한다.
        const today = Clock.today; // https://martinfowler.com/bliki/ClockWrapper.html
        invoice.dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 30);

        printDetails();

        function printBanner(){
            console.log('***********');
            console.log('**고객 채무**');
            console.log('***********');
        }

        function printDetails(){
            console.log(`고객명: ${invoice.customer}`);
            console.log(`채무액: ${outstanding}`);
            console.log(`마감일: ${invoice.dueDate.toLocaleDateString()}`);
        }
    }
```

2. 추출할 부분을 새로운 함수로 복사한다.
3. 새로운 함수에서 값을 반환하고, 추출한 코드의 원래 자리를 새로 뽑아낸 함수를 호출하는 문장으로 교체한다.
4. 반환값의 이름을 내 코딩 스타일에 맞게 바꾼다.

```js
    function printOwing(invoice) {
        printBanner();

        let outstanding = calculateOutstanding(invoice);
        // 마감일을 기록한다.
        const today = Clock.today; // https://martinfowler.com/bliki/ClockWrapper.html
        invoice.dueDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 30);

        printDetails();

        function printBanner(){
            console.log('***********');
            console.log('**고객 채무**');
            console.log('***********');
        }

        function printDetails(){
            console.log(`고객명: ${invoice.customer}`);
            console.log(`채무액: ${outstanding}`);
            console.log(`마감일: ${invoice.dueDate.toLocaleDateString()}`);
        }

        function calculateOutstanding(invoice){
            let result = 0;
            // 미해결 채무를 계산한다.
            for (const o of invoice.orders) {
                result += o.amount;
            }
        }
    }
```


## 6-2. 함수 인라인하기

