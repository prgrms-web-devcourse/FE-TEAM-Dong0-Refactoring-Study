# 3장

## 3.7 뒤엉킨 변경(Divergent Change)

- 소프트웨어의 구조는 변경하기 쉬워야 한다 === 수정할 때 시스템에서 딱 해당 부분만 수정한다
- 단일 책임 원칙(Single Responsibility Principle)
  - 책임별로 모듈을 분리, 변경 발생에도 다른 동작에 영향 X
- 뒤엉킨 변경: 하나의 모듈이 여러가지 방식으로 변경되는 일이 많아질 때 발생
- 해법
  - 출력 결과 묶어서 다음 로직으로 전달은 **단계 쪼개기**
  - 모듈이 클래스라면 **클래스 추출하기**

## 3.8 산탄총 수술(Shotgun Surgery)

- 산탄총 수술: 맥락을 구분이 어려워진다는 점에서 뒤엉킨 변경과 유사하지만, 산탄총 수술은 변경할 부분이 전반에 퍼져 있다는 점에서 반대이다.
- 해법
  - 함께 변경되는 대상을 **함수 옮기기**, **필드 옮기기**로 한 모듈에 묶기
  - 비슷한 데이터를 함수가 많다면 **여러 함수를 클래스로 묶기**
  - 데이터 구조 변환, 보강에는 **여러 함수를 변환 함수로 묶기**
  - 출력 결과 묶어서 다음 로직으로 전달은 **단계 쪼개기**
  - 분리된 로직에서 **함수 인라인하기**, **클래스 인라인하기**

## 3.9 기능 편애(Feature Envy)

- 프로그램을 모듈화할 땐 코드를 영역으로 나누고, 영역 안에서는 상호작용 최대화, 영역 간의 상호작용은 최소화해야 함
- 기능 편애: 어떤 함수가 자기가 속한 모듈의 함수나 데이터보다 다른 모듈의 함수나 데이터와 상호작용을 더 많이함을 의미
- 해법
  - 많이 쓰인 데이터 근처로 **함수 옮기기**
  - 함수의 일부라면 **함수 추출하기** 후 **함수 옮기기**
  - 함수가 사용하는 모듈이 다양하다면 가장 많은 데이터를 포함한 모듈로 옮기기 or **함수 추출하기**로 각각 옮기기
- 예외로 옮기기가 어려운 디자인 패턴으로 전략 패턴, 방문자 패턴이 있다.

## 3.10 데이터 뭉치(Data Clumps)

- 몰려다니는 데이터를 뭉쳐줘야 한다.
- 해법
  - 필드 형태의 뭉치는 **클래스 추출하기**로 객체화
  - 메서드 시그니처\*는 **매개변수 객체 만들기**, **객체 통째로 넘기기**
    - \* 메서드의 정의에서 메서드 이름과 매개변수 리스트의 조합

## 3.11 기본형 집착(Primitive Obsession)

- 기본 타입에 대한 강박관념
- 해법
  - **기본형을 객체로 바꾸기**
  - **타입 코드를 서브클래스로 바꾸기**, **조건부 로직을 다형성으로 바꾸기**

## 3.12 반복되는 switch문(Repeated Switches)

- 조건절이 추가될 때마다 다른 switch문도 찾아서 수정해야 함
- 해법
  - **조건부 로직을 다형성으로 바꾸기**

### 단계 쪼개기(p214)

- 서로 다른 대상을 다루는 여러 단계의 코드에 대해 적용

1. 두 번째 단계 함수로 추출
2. 첫 번째 단계와 두 번째 단계가 주고받을 중간 데이터 구조 생성
3. 첫 번째 단계에서 생성되는 변수는 중간 데이터 구조에, 아닌 변수는 그대로 매개변수로 사용
4. 첫 번째 단계 함수도 해당 데이터 구조를 반환하도록 함수로 추출

### 함수 옮기기(p278)

- 중첩 함수를 최상위, 혹은 다른 클래스로 옮김

### 함수 추출하기(p158)

- 원본 코드를 추출하여 이름을 잘 지은 함수에 붙여넣는다.

### 클래스 추출하기(p260)

- 일부 데이터와 메서드를 따로 묶을 수 있다면 분리하여 클래스 크기의 비대를 막자

### 필드 옮기기(p289)

- 한 레코드(클래스)를 변경하려 할 때 다른 레코드의 필드(데이터 저장되는 멤버)까지 변경해야 한다면 위치 옮기자

### 여러 함수를 클래스로 묶기(p202), 여러 함수를 변환 함수로 묶기(p208)

- 정보를 도출시키는 함수를 클래스 혹은 함수로 묶음
- 원본 데이터가 코드 안에서 갱신될 때는 클래스로, 아니면 변환 함수로

### 함수 인라인하기(p169)

- 쓸데없는 간접 호출 줄임

### 클래스 인라인하기(p264)

- 특정 클래스에 남은 역할이 거의 없을 때 다른 클래스로 흡수

### 매개변수 객체 만들기(p197)

- 매개변수로 데이터가 뭉쳐다니면 객체나 클래스로 표현된 매개변수로 바꾼다.

### 객체 통째로 넘기기(p427)

- 하나의 레코드에서 값 2개 정도를 가져와서 쓴다면, 통째로 넘기고 본문에서 필요한 값을 꺼내 쓴다.

### 기본형을 객체로 바꾸기(p251)

- 단순한 출력 이상의 기능이 필요해지면 클래스와 getter, setter로 감싼다.

### 타입 코드를 서브클래스로 바꾸기(p487)

- 슈퍼클래스로 생성되는 인스턴스에 타입이 있다면, 타입별로 분기를 만들어 서브클래스를 내려준다.

### 조건부 로직을 다형성으로 바꾸기(p366)

1. 다형적 동작하는 클래스(`Bird`) 만들기, 팩터리 함수(`createBird`) 만들기
2. 팩터리 함수 사용
3. 조건부 로직(`airSpeedVelocity(), plumage()`)을 슈퍼클래스로 옮김
4. switch절의 조건 하나를 서브클래스의 메서드로 오버라이드한다.
5. 슈퍼클래스는 기본 동작만 남긴다.
