## 리팩토링

컴파일러는 코드가 깔끔하든 지저분하든 신경쓰지 않고, 자신의 할 일을 한다. 하지만 그 코드를 수정하는데 사람이 개입이 되고, 사람은 코드의 미적상태에 민감하다. 또한, 설계가 나쁜 시스템은 무엇을 수정할지 찾기 어려워 버그가 생길 가능성이 높다.  
=> 수백 줄짜리 코드를 수정할 때면 먼저 프로그램의 작동방식을 더 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성한다. 구조부터 바로잡은 뒤에 기능을 수정하는 편이 작업하기 훨씬 수월하다.  
=> 프로그램이 새로운 기능을 추가하기 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.

오래 사용할 코드라면 중복코드는 좋지 않다.

리팩토링이 필요한 이유는 변경 때문이다. 변경하지 않을 코드라면 리팩토링이 크게 필요하지 않다.

### 리팩토링의 첫 단계

첫 단계는 리팩터링할 코드 영역을 꼼꼼하게 검사해줄 테스트 코드들을 마련해야 한다.
리팩터링에서 테스트의 역할은 굉장히 중요하다. 리팩터링 기법들이 버그 발생여지를 최소화했다고는 하지만 실제 작업은 사람이 하기 떄문에 언제든지 실수할 수 있고, 예상치 못한 일이 일어날 수도 있다.  
=> 성공/실패를 스스로 판단하는 자가진단 테스트로 만드는 것이 중요하다.
(최신 프레임워크들은 자가진단 테스트를 작성하고 실행하는데 필요한 모든 기능을 제공한다.)

=> 리팩터링하기 전에 제대로된 테스트부터 마련하고, 이 테스트는 반드시 자가진단하도록 만든다.

### 함수 쪼개기

긴 함수를 리팩터링할 때는 먼저 전체 동작을 각각의 부분으로 나눌 수 있는 지점을 찾아야한다.
이렇게 파악한 부분을 잊지 않기 위해서는 코드에 반영해 다음 코드를 볼 때 다시 분석하지 않고도 스스로 알 수 있게 해야 한다.

추출한 함수에는 그 코드가 하는 일을 설명하는 이름을 지어준다.
만약 별도의 함수로 꺼냈을 때 새로운 함수에서 사용하지 못하는 변수가 있는지 파악한다. 이런 값들은 매개변수로 전달해 주면 된다. 또, 함수안에서 값이 변경되는 변수들은 변경된 값을 리턴해준다.

아무리 간단한 리팩터링 이라도 이후 항상 테스트하는 것을 습관들이는 것이 좋다.
=> 테스트를 했을 때 오류가 생겨도 변화 폭이 작기 때문에 쉽게 버그를 찾을 수 있다.
=> 조금씩 자주 디버깅.

**프로그램 수정을 작은 단계로 나눠진행하여 중간에 실수하더라도 버그를 쉽게 찾을 수 있게 한다.**

하나의 리팩터링을 문제없이 끝낼 때마다 커밋하여 중간에 문제가 생기더라도 이전의 정상 상태로 쉽게 돌아갈 수 있도록한다. 이렇게 자잘한 변경들이 어느정도 의미가 있는 단위로 뭉쳐지면 push한다. (변수이름을 하나 바꿀 때도 컴파일 - 테스트 - 커밋을 한다.)

함수를 추출하고 나서 더 명확하게 표현할 수 있는 방법이 있는지 찾는다.
먼저 변수명을 더 명확하게 바꾼다.
자바스크립트처럼 동적 언어를 사용하면 타입이 드러나게 작성하면 좋다.
매개변수 이름에 접두어로 타입이름을 적는데 매개변수의 역할이 뚜렷하지 않을 때는 부정 관사(a/an)을 붙인다.
**컴퓨터가 이해하는 코드는 바보도 작성할 수 있지만 사람이 이해하도록 작성하는 프로그래머가 진정한 실력자이다.**

- 지역변수를 제거해서 얻는 가장 큰 장점은 추출 작업이 훨씬 쉬워진다는 것이다. 유효 범위를 신경써야 할 대상이 줄어들기 때문이다.

- 임시변수도 나중에 문제를 일으킬 수 있다. 임시변수는 자신이 속산 루틴에서만 의미가 있어서 루틴이 길고 복잡해지기 쉽다.

- 이름짓기는 중요하면서도 쉽지 않은 작업이다. 긴 함수를 작게 쪼개는 리팩터링은 이름을 잘 지어야만 효과가 있다.

- 반복문을 한바퀴 돌때마다 값을 누적하는 리팩터링하기 어려운 변수는 반복문 쪼개기로 값이 누적되는 부분을 따로 빼낸다.

### 성능

리팩토링이 성능에 상당한 영향을 주기도 한다. 하지만 이런 경우라도 개의치 않고 리팩터링한다. 잘 다듬어진 코드여야 성능 개선 작업도 훨씬 수월하기 떄문이다. 리팩터링 과정에서 성능이 떨어졌다면 리팩터링 후 시간을 내어 성능을 개선한다.
